{% extends 'base_layout.html' %}
{% load static %}
{% block content %}
        <!-- Masthead-->
        <header class="masthead">
            <div class="container">
                <div class="masthead-subheading">PeopleSkills est une plateforme d'échange de biens et services entre particuliers</div>
                <div class="masthead-subheading">Proposez vos services ou biens, et recevez-en en échange!</div>
                <div class="container">
                    {{ departements_dict|json_script:"departements_dict" }}
                    <div id='category' data-value="{{cate}}"hidden></div>
                    <div id="dep_choice_position" data-value="{{departement_choice_position}}" hidden></div>
                    <form method = 'get' action = "{% url 'application:search_results' %}">
                        <div class="row">
                            <div class="col-lg-3">
                                <select name="region" id="region-menu" class="custom-select">
                                    {% for key in departements_dict %}
                                    {% if region == key %}
                                    <option value="{{key}}" selected>{{key}}</option>
                                    {% else %}
                                    <option value="{{key}}">{{key}}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-lg-3">
                                <select name="departement" id="departement-menu" class="custom-select">
                                </select>
                            </div>
                            <div class="col-lg-3">
                                <select name="category" class="custom-select">
                                    {% for cat_name in cat_names %}
                                    {% if cate == cat_name %}
                                    <option value="{{cat_name}}"selected>{{cat_name}}</option>
                                    {% else %}
                                    <option value="{{cat_name}}">{{cat_name}}</option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-lg-3">
                                <input id="rechercher-btn" type="submit" value="Rechercher">
                            </div>
                    </div>
                </form>
            </div>
        </header>
        <div class="container">
            <div class="row">
                <div class="col-sm-12 results-info">
                    <p>Bonjour, {{total_nb_users}} membres au total sur PeopleSkills en France, pour les contacter, créez un compte ou connectez-vous.</p>
                </div>
                <div class="col-sm-12 members">
                 <p>Dans votre recherche: {{nb_users}} membres inscrits</p>
                </div>
                <div class="col-sm-4 services-menu">
                <h4>Catégories</h4>
                 {% for category_name, users_in_cat in cat_dict.items %}
                    <a href="{% url 'application:search_results' %}?region={{region}}&departement={{departement}}&category={{category_name}}">{{category_name}} ({{users_in_cat}})</a></br>
                    <ul class='selected_category' data-value="{{category_name}}">
                        {% for key, small_services_dict in services_dict.items %}
                            {% if key == category_name %}
                                {% for k,v in small_services_dict.items %}
                                <li><a href="{% url 'application:search_results' %}?region={{region}}&departement={{departement}}&category={{category_name}}&service={{k}}">{{k}} ({{v}})</a></li>
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </ul>
                 {% endfor %}
                </div>
                {% for user in users_info %}
                <div class="col-sm-8 services-menu">
                    <div class = "row">
                        <div class="col-sm-3">
                            {% if user.gender %}
                                <p><img class = 'avatar' src="{% static 'assets/img/avatar_m.svg' %}" alt=""/></p>
                            {% else %}
                                <p><img class = 'avatar' src="{% static 'assets/img/avatar_f.svg' %}" alt=""/></p>
                            {% endif %}
                        </div>
                        <div class="col-sm-9">
                            {% if request.user.is_authenticated %}
                                {% if request.user.pk != user.pk %}
                                <div class="row" class="upper_reduced_profile">
                                <a href="{% url 'useraccount:score' %}?receiver={{user.username}}"><p class = 'username'>{{user.username}}</p></a>
                                </div>
                                {% else %}
                                <div class="row" class="upper_reduced_profile">
                                <p class = 'username'>{{user.username}}</p>
                                </div>
                                {% endif %}
                            {% else %}
                            <div class="row" class="upper_reduced_profile">
                                <p class = 'username'>{{user.username}}</p>
                            </div>
                            {% endif %}
                            {% if request.user.is_authenticated %}
                            <div>
                                <p>{{user.email}}</p>
                            </div>
                            {% endif %}
                            <div class="row">
                                <p>{{user.postcode}}</p>
                            </div>
                            <div class="row">
                                <p>Services recherchés:</p>
                                {% for required_service in user.required_services %}
                                    <p>{{required_service.name}}</p>
                                {% endfor %}
                            </div>
                            <div class="row">
                                <p>Sercices proposés:</p>
                                {% for proposed_service in user.proposed_services %}
                                    <p>{{proposed_service.name}}</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
{% endblock %}
